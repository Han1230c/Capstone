<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments :: head('Inventory Management - Vintage Vinyl')}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
<nav th:replace="~{fragments :: navigation}"></nav>

<div class="container-fluid mt-5 vintage-container">
    <!-- Dashboard Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white vintage-card">
                <div class="card-body">
                    <h5 class="card-title">Total Items</h5>
                    <h2 class="card-text" th:text="${records.size()}">0</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning vintage-card">
                <div class="card-body">
                    <h5 class="card-title">Low Stock Items</h5>
                    <h2 class="card-text" th:text="${lowStockRecords.size()}">0</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-danger text-white vintage-card">
                <div class="card-body">
                    <h5 class="card-title">Out of Stock</h5>
                    <h2 class="card-text" th:text="${outOfStockRecords.size()}">0</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white vintage-card">
                <div class="card-body">
                    <h5 class="card-title">Total Stock</h5>
                    <h2 class="card-text" th:text="${totalStock}">0</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Section -->
    <div class="row mb-4" th:if="${!#lists.isEmpty(lowStockRecords)}">
        <div class="col-12">
            <div class="alert alert-warning vintage-alert">
                <h5><i class="fas fa-exclamation-triangle"></i> Low Stock Alerts</h5>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                        <tr>
                            <th>Title</th>
                            <th>Artist</th>
                            <th>Current Stock</th>
                            <th>Threshold</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="record : ${lowStockRecords}">
                            <td th:text="${record.title}"></td>
                            <td th:text="${record.artist}"></td>
                            <td th:text="${record.stock}"></td>
                            <td th:text="${record.lowStockThreshold}"></td>
                            <td>
                                <button class="btn btn-warning btn-sm update-stock vintage-btn"
                                        th:data-id="${record.id}"
                                        th:data-title="${record.title}"
                                        th:data-current-stock="${record.stock}">
                                    Update Stock
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Inventory Table -->
    <div class="row">
        <div class="col-12">
            <div class="card vintage-card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Inventory Management</h5>
                    <div>
                        <button class="btn btn-light btn-sm vintage-btn" id="batchUpdateBtn">
                            <i class="fas fa-boxes"></i> Batch Update
                        </button>
                        <button class="btn btn-light btn-sm vintage-btn" onclick="exportInventory()">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover vintage-table" id="inventoryTable">
                            <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAll"></th>
                                <th>Title</th>
                                <th>Artist</th>
                                <th>Current Stock</th>
                                <th>Low Stock Threshold</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="record : ${records}">
                                <td><input type="checkbox" class="record-select" th:data-id="${record.id}"></td>
                                <td th:text="${record.title}"></td>
                                <td th:text="${record.artist}"></td>
                                <td>
                                    <span th:text="${record.stock}" th:class="${record.stock <= record.lowStockThreshold ? 'text-danger font-weight-bold' : ''}"></span>
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm threshold-input vintage-input"
                                           th:value="${record.lowStockThreshold}"
                                           th:data-id="${record.id}"
                                           min="0" style="width: 80px">
                                </td>
                                <td>
                                    <span class="badge"
                                          th:classappend="${record.stock == 0 ? 'badge-danger' :
                                                        (record.stock <= record.lowStockThreshold ? 'badge-warning' : 'badge-success')}"
                                          th:text="${record.stock == 0 ? 'Out of Stock' :
                                                 (record.stock <= record.lowStockThreshold ? 'Low Stock' : 'In Stock')}">
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-primary btn-sm update-stock vintage-btn"
                                            th:data-id="${record.id}"
                                            th:data-title="${record.title}"
                                            th:data-current-stock="${record.stock}">
                                        <i class="fas fa-edit"></i> Update Stock
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Update Modal -->
    <div class="modal" id="stockUpdateModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Stock</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="recordId">
                    <div class="form-group">
                        <label>Record: <span id="recordTitle"></span></label>
                    </div>
                    <div class="form-group">
                        <label for="newQuantity">New Stock Quantity</label>
                        <input type="number" class="form-control" id="newQuantity" min="0">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveStock">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Batch Update Modal -->
    <div class="modal" id="batchUpdateModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Batch Update Stock</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Selected Records</label>
                        <div class="table-responsive">
                            <table class="table" id="batchUpdateTable">
                                <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Current Stock</th>
                                    <th>New Stock</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Update Reason</label>
                        <label for="batchUpdateReason"></label><select class="form-control" id="batchUpdateReason">
                            <option value="RESTOCK">Restock</option>
                            <option value="ADJUSTMENT">Inventory Adjustment</option>
                            <option value="OTHER">Other</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveBatchUpdate">Save</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="/inventory-management.js"></script>

<!-- Custom Vintage CSS -->
<style>
    /* Vintage theme setup */
    body {
        font-family: 'Roboto Slab', serif;
        background-color: #faf4e5;
        color: #4a3c31;
    }

    .vintage-container {
        background-color: #f7efe3;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .vintage-card {
        border: 1px solid #d1b894;
        background-color: #fdfcf8;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
    }

    .card-title, .card-header h5 {
        color: #4a3c31;
        font-weight: bold;
    }

    /* Alert styling */
    .vintage-alert {
        background-color: #e2a03e;
        color: #4a3c31;
        border-radius: 8px;
        font-weight: bold;
    }

    /* Button styling */
    .vintage-btn {
        font-family: 'Roboto Slab', serif;
        background-color: #8b5e34;
        border-color: #8b5e34;
        color: #fff;
    }

    .vintage-btn:hover {
        background-color: #6d4c30;
        border-color: #6d4c30;
    }

    /* Table styling */
    .vintage-table th, .vintage-table td {
        border-color: #d1b894;
        padding: 0.75rem;
    }

    .badge {
        padding: 0.5em 1em;
        font-size: 0.9em;
        color: #4a3c31;
    }

    .badge-danger {
        background-color: #c55146;
    }

    .badge-warning {
        background-color: #e2a03e;
        color: #4a3c31;
    }

    .badge-success {
        background-color: #6c8f4e;
    }

    .threshold-input:focus {
        border-color: #8b5e34;
        box-shadow: none;
    }
</style>
</body>
</html>
